#!/bin/bash

export SWMASTER=${1:-http://localhost:9000/}
export OUTPUT_FILE=${2:-./results.csv}

BENCHMARK=./loop

rm -r -f "${OUTPUT_FILE%.*}/task-crawler/"
mkdir -p "${OUTPUT_FILE%.*}/task-crawler/"

echo "Script,Comment,Iteration,Average Memory (KiB),Avg. CPU Time,Total Time,Exit Status" > $OUTPUT_FILE
echo "Script,Comment,Iteration Count,Job URL,No of Tasks,Job Duration" > "${OUTPUT_FILE%.*}/task-crawler/summary.csv"

# PI CALC

for n in $(eval echo "{1..15}"); do
	
	export PI_COUNT=$n
	let x=100000000/$PI_COUNT
	export PI_JUMP=$x
	
	$BENCHMARK stubs/picalc.sw "$PI_COUNT threads, $PI_JUMP iterations" 4
	
done

# FIB MEMOISED

for n in $(eval echo "{1..8}") 10 20 30 40 50 60 70 80; do
	
	export FIB_N=$n
	export FIB_MEM=0
	$BENCHMARK stubs/fib.sw "Fib($n) Memoised" 4
	
done

# FIB NON-MEMOISED

for n in $(eval echo "{1..8}"); do
	
	export FIB_N=$n
	export FIB_MEM=1
	$BENCHMARK stubs/fib.sw "Fib($n) Non-Memoised" 4
	
done

# LINKED LIST

for n in $(eval echo "{0..20}"); do
	
	export LIST_SIZE=$n
	$BENCHMARK stubs/linkedlist.sw "List Length = $n" 4
	
done

# MANDELBROT

for n in $(eval echo "{1..15}"); do
	
	export MAN_SPLITX=$n
	export MAN_SPLITY=1
	$BENCHMARK stubs/mandelbrot.sw "Mandelbrot (${MAN_SPLITX} x ${MAN_SPLITY} tiles)" 4
	
done





